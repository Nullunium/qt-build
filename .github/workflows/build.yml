name: Build Qt WebEngine

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    # - name: Set up Visual Studio environment
    #   run: |
    #     & "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Auxiliary\Build\vcvars64.bat"
    - name: Install dependencies
      run: |
        sudo apt install gperf flex bison perl ninja-build nodejs g++ cmake \
        libfontconfig1-dev \
        libfreetype-dev \
        libgtk-3-dev \
        libx11-dev \
        libx11-xcb-dev \
        libxcb-cursor-dev \
        libxcb-glx0-dev \
        libxcb-icccm4-dev \
        libxcb-image0-dev \
        libxcb-keysyms1-dev \
        libxcb-randr0-dev \
        libxcb-render-util0-dev \
        libxcb-shape0-dev \
        libxcb-shm0-dev \
        libxcb-sync-dev \
        libxcb-util-dev \
        libxcb-xfixes0-dev \
        libxcb-xkb-dev \
        libxcb1-dev \
        libxext-dev \
        libxfixes-dev \
        libxi-dev \
        libxkbcommon-dev \
        libxkbcommon-x11-dev \
        libxrender-dev \
        clang-16 \
        libclang-16-dev \
        llvm-16 \
        clang-17 \
        libclang-17-dev \
        llvm-17 \
        libgl-dev \
        libegl-dev \
        libfontconfig1-dev \
        libinput-dev \
        libatspi2.0-dev libnss3-dev libssl-dev libx11-dev libxext-dev libxtst-dev libxcomposite-dev libxdamage-dev libxrandr-dev libfontconfig1-dev libfreetype6-dev libpng-dev libjpeg-dev zlib1g-dev
        pip install html5lib
    - name: Clone Qt repository
      run: git clone https://code.qt.io/qt/qt5.git
    - name: Checkout version 6.8.3
      run: |
        cd qt5
        git checkout v6.8.3
    - name: Initialize submodules
      run: |
        cd qt5
        perl "./init-repository"
    - name: Create build directory
      run: mkdir qt-build
    - name: Configure Qt
      run: |
        cd qt-build
        ../qt5/configure -prefix qt-install -webengine-proprietary-codecs -release -opensource -confirm-license 
    - name: Build Qt
      run: |
        cmake qt5
        cmake --build qt-build --parallel 
    - name: Install Qt
      run: |
        cd qt-build
        cmake --install . 
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: qt-webengine
        path: qt-build/qt-install